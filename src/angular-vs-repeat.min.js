//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(b,d,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=d===a?0:d.getBoundingClientRect()[e?"left":"top"],h=f-g+(d===a?c():d)[e?"scrollLeft":"scrollTop"];return h}var g=("undefined"!=typeof a.onwheel?"wheel":"undefined"!=typeof a.onmousewheel?"mousewheel":"DOMMouseScroll",document.documentElement),h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null,i=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[h](a);)c=c.parentNode;return c&&c[h](a)?b.element(c):b.element()},j=b.module("vs-repeat",[]).directive("vsRepeat",["$compile",function(c){return{restrict:"A",scope:!0,require:"?^vsRepeat",controller:["$scope",function(a){this.$scrollParent=a.$scrollParent,this.$fillElement=a.$fillElement}],compile:function(g){var h=g.children().eq(0),j=h.attr("ng-repeat")||h.attr("data-ng-repeat"),k=h[0].outerHTML,l=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(j),m=l[1],n=l[2],o=l[3],p="$vs_collection",q={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};return g.empty(),a.getComputedStyle&&"absolute"===a.getComputedStyle(g[0]).position||g.css("position","relative"),{pre:function(g,h,j,l){function r(a,c){if(!C||C.length<1)return g[p]=[],z=0,v(0),void(g.sizesCumulative=[0]);if(z=C.length,F){g.sizes=C.map(function(a){var c=g.$new(!1);b.extend(c,a),c[m]=a;var d=j.vsSize||j.vsSizeProperty?c.$eval(j.vsSize||j.vsSizeProperty):g.elementSize;return c.$destroy(),d});var d=0;g.sizesCumulative=g.sizes.map(function(a){var b=d;return d+=a,b}),g.sizesCumulative.push(d)}else s();u(c)}function s(){E&&g.$$postDigest(function(){if(h[0].offsetHeight||h[0].offsetWidth)for(var a=h.children(),b=0;b<a.length;){if(null!=a[b].attributes["ng-repeat"]||null!=a[b].attributes["data-ng-repeat"]){a[b][L]&&(g.elementSize=a[b][L],u(),E=!1,g.$root&&!g.$root.$$phase&&g.$apply());break}b++}else var c=g.$watch(function(){(h[0].offsetHeight||h[0].offsetWidth)&&(c(),s())})})}function t(){"undefined"!=typeof j.vsAutoresize&&(E=!0,s(),g.$root&&!g.$root.$$phase&&g.$apply()),y()&&(g.$apply(),g.$broadcast("vsSetOffset-refresh"))}function u(a){O=void 0,P=void 0,Q=z,R=0,y(a),v(F?g.sizesCumulative[z]:g.elementSize*z),g.$evalAsync(function(){g.$broadcast("vsSetOffset-refresh")}),g.$emit("vsRepeatReinitialized",g.startIndex,g.endIndex)}function v(a){if(D){if(A.css({width:g.offsetBefore+a+g.offsetAfter+"px",height:"100%"}),l&&l.$fillElement){var b=l.$fillElement[0].parentNode.querySelector("[ng-repeat]");b&&l.$fillElement.css({width:b.scrollWidth+"px"})}}else A.css({height:g.offsetBefore+a+g.offsetAfter+"px",width:"100%"}),l&&l.$fillElement&&(b=l.$fillElement[0].parentNode.querySelector("[ng-repeat]"),b&&l.$fillElement.css({height:b.scrollHeight+"px"}))}function w(){var a=d(G[0],K);a!==S&&(u(),g.$root&&!g.$root.$$phase&&(g.$apply(),g.$broadcast("vsSetOffset-refresh"))),S=a}function x(a){var b=!1;return void 0!==a&&"number"==typeof a&&(b=Math.max(a,0),G[0][M]!==b?(G[0][M]=b,I=!0):b=!1,g.$emit("vsRepeatScrolled",b)),b}function y(a){var b,c,i,j,k=e(G[0],M),l=d(G[0],K),m=h[0]===G[0]?0:f(h[0],G[0],D),n=!0,o=g.startIndex,q=g.endIndex;if(a&&void 0!==a.elementSize&&(g.elementSize=a.elementSize),a&&void 0!==a.scrollIndex){if("undefined"!=typeof g.scrollSettings&&(g.scrollSettings.scrollIndex=a.scrollIndex),F?(j=g.sizes[a.scrollIndex],i=g.sizesCumulative[a.scrollIndex]):(j=g.elementSize,i=a.scrollIndex*g.elementSize),void 0!==a.scrollIndexPosition)switch("undefined"!=typeof g.scrollSettings&&(g.scrollSettings.scrollIndexPosition=a.scrollIndexPosition),b=0,typeof a.scrollIndexPosition){case"number":b=a.scrollIndexPosition+g.offsetBefore;break;case"string":switch(a.scrollIndexPosition){case"top":b=g.offsetBefore;break;case"middle":b=(l-j)/2;break;case"bottom":b=l-j-g.offsetAfter;break;case"inview":case"inview#top":case"inview#middle":case"inview#bottom":case"inview#auto":G[0][M]<=i&&G[0][M]+l-j>=i?(n=!1,b=i-G[0][M]):(("inview#top"===a.scrollIndexPosition||"inview"===a.scrollIndexPosition)&&(b=g.offsetBefore),"inview#bottom"===a.scrollIndexPosition&&(b=l-j+g.offsetAfter),"inview#middle"===a.scrollIndexPosition&&(b=(l-j)/2),"inview#auto"===a.scrollIndexPosition&&(b=G[0][M]<=i?l-j+g.offsetAfter:g.offsetBefore));break;default:console.warn("Incorrect scrollIndexPosition string value")}break;default:console.warn("Incorrect scrollIndexPosition type")}else n=!1,b=F?g.sizesCumulative[a.scrollIndex]-G[0][M]:a.scrollIndex*g.elementSize-G[0][M];if(o=a.scrollIndex,F){for(;g.sizesCumulative[o]>g.sizesCumulative[a.scrollIndex]-b;)o--;for(c=Math.max(o,0),o=Math.max(Math.floor(o-g.excess/2),0),q=o;g.sizesCumulative[q]<g.sizesCumulative[c]-g.offsetBefore+l;)q++;q=Math.min(Math.ceil(q+g.excess/2),z)}else{for(;o*g.elementSize>a.scrollIndex*g.elementSize-b;)o--;c=Math.max(o,0),o=Math.max(Math.floor(o-g.excess/2),0),q=Math.min(o+Math.ceil(l/g.elementSize)+g.excess/2,z)}}else if(F){for(o=0;g.sizesCumulative[o]<k-g.offsetBefore-m;)o++;for(o>0&&o--,o=Math.max(Math.floor(o-g.excess/2),0),q=o;g.sizesCumulative[q]<k-g.offsetBefore-m+l;)q++;q=Math.min(Math.ceil(q+g.excess/2),z)}else o=Math.max(Math.floor((k-g.offsetBefore-m)/g.elementSize)-g.excess/2,0),q=Math.min(o+Math.ceil(l/g.elementSize)+g.excess,z);Q=Math.min(o,Q),R=Math.max(q,R),g.startIndex=J.latch?Q:o,g.endIndex=J.latch?R:q,void 0!==a&&void 0!==a.scrollIndex&&void 0!==b&&n&&x(i-b);var r=!1;return null==O?r=!0:null==P&&(r=!0),r||(J.hunked?Math.abs(g.startIndex-O)>=g.excess/2||0===g.startIndex&&0!==O?r=!0:(Math.abs(g.endIndex-P)>=g.excess/2||g.endIndex===z&&P!==z)&&(r=!0):r=g.startIndex!==O||g.endIndex!==P),r&&(g[p]=C.slice(g.startIndex,g.endIndex),g.$emit("vsRepeatInnerCollectionUpdated",g.startIndex,g.endIndex,O,P),O=g.startIndex,P=g.endIndex),r}var z,A,B=b.element(k),C=[],D="undefined"!=typeof j.vsHorizontal,E=!j.vsRepeat,F=!!j.vsSize||!!j.vsSizeProperty,G=j.vsScrollParent?"window"===j.vsScrollParent?b.element(a):i.call(h,j.vsScrollParent):h,H=D?"left":"top",I=!1,J="vsOptions"in j?g.$eval(j.vsOptions):{},K=D?"clientWidth":"clientHeight",L=D?"offsetWidth":"offsetHeight",M=D?"scrollLeft":"scrollTop";if(!("vsSize"in j)&&"vsSizeProperty"in j&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attrubute which also accepts angular expressions."),0===G.length)throw"Specified scroll parent selector did not match any element";g.$scrollParent=G,F&&(g.sizesCumulative=[]),g.elementSize=+j.vsRepeat||d(G[0],K)||50,g.offsetBefore=0,g.offsetAfter=0,g.excess=2,g.scrollSettings={scrollIndex:0,scrollIndexPosition:"top"},g.$watch(j.vsScrollSettings,function(a){"undefined"!=typeof a&&(g.scrollSettings=a,u(g.scrollSettings))},!0),Object.keys(q).forEach(function(a){j[a]&&j.$observe(a,function(b){g[q[a]]=+b,u()})}),g.$watchCollection(n,function(a){C=a||[],r()}),B.attr("ng-repeat",m+" in "+p+(o?" "+o:"")).addClass("vs-repeat-repeated-element");var N=F?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)";B.attr("vs-set-offset",N),B.attr("vs-set-offset-positioning-property",H),c(B)(g),h.append(B),A=b.element('<div class="vs-repeat-fill-element"></div>').css({position:"relative","min-height":"100%","min-width":"100%"}),h.append(A),c(A)(g),g.$fillElement=A;g.startIndex=0,g.endIndex=0,G.on("scroll",function(){I?I=!1:y()&&(g.$apply(),g.$broadcast("vsSetOffset-refresh"))}),b.element(a).on("resize",t),g.$on("$destroy",function(){b.element(a).off("resize",t)}),g.$on("vsRepeatTrigger",r),g.$on("vsRepeatResize",function(){E=!0,s()});var O,P,Q,R;g.$on("vsRenderAll",function(){J.latch&&setTimeout(function(){var a=z;R=Math.max(a,R),g.endIndex=J.latch?R:a,g[p]=C.slice(g.startIndex,g.endIndex),P=g.endIndex,g.$apply(function(){g.$emit("vsRenderAllDone")})})});var S;g.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(w):w()})}}}}}]).directive("vsSetOffset",[function(){return function(a,b,c){function d(){b.css(e,a.$eval(c.vsSetOffset)+"px")}var e=c.vsSetOffsetPositioningProperty;d(),a.$on("vsSetOffset-refresh",d)}}]);b.element(document.head).append(["<style>.vs-repeat-wheel-helper{position: absolute;top: 0;bottom: 0;left: 0;right: 0;z-index: 99999;background: rgba(0, 0, 0, 0);}.vs-repeat-repeated-element{position: absolute;z-index: 1;}</style>"].join("")),"undefined"!=typeof module&&module.exports&&(module.exports=j.name)}(window,window.angular);